{% extends 'base.html' %}
{% load static %}

{% block title %}{{ site_settings.site_name }} - Pure Welsh Mountain Spring Water{% endblock %}

{% block extra_css %}
<style>
    /* Welsh-inspired custom animations */
    .welsh-gradient {
        background: linear-gradient(135deg, #1e3a8a 0%, #065f46 50%, #374151 100%);
        background-size: 400% 400%;
        animation: mountainFlow 12s ease infinite;
    }
    
    @keyframes mountainFlow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .mountain-mist {
        background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(59,130,246,0.1), rgba(255,255,255,0.05));
        background-size: 200% 200%;
        animation: mistFlow 8s ease-in-out infinite;
    }
    
    @keyframes mistFlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }
    
    .spring-ripple {
        background: radial-gradient(circle at center, transparent 0%, rgba(59, 130, 246, 0.2) 50%, transparent 100%);
        animation: springRipple 4s ease-out infinite;
    }
    
    @keyframes springRipple {
        0% { transform: scale(0); opacity: 1; }
        100% { transform: scale(6); opacity: 0; }
    }
    
    .welsh-text-shimmer {
        background: linear-gradient(90deg, #1e40af, #059669, #1e40af);
        background-size: 200% 100%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: welshShimmer 3s ease-in-out infinite;
    }
    
    @keyframes welshShimmer {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }
    
    .floating-mountain {
        animation: mountainFloat 8s ease-in-out infinite;
    }
    
    @keyframes mountainFloat {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-30px) rotate(2deg); }
    }
    
    .water-drop {
        animation: dropFall 3s ease-in-out infinite;
    }
    
    @keyframes dropFall {
        0% { transform: translateY(-20px); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: translateY(20px); opacity: 0; }
    }
    
    .celtic-pattern {
        background-image: 
            radial-gradient(circle at 25% 25%, #1e40af 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, #059669 0%, transparent 50%);
        opacity: 0.1;
        animation: celticPulse 10s ease-in-out infinite;
    }
    
    @keyframes celticPulse {
        0%, 100% { opacity: 0.1; }
        50% { opacity: 0.2; }
    }
    
    .mountain-card {
        background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.2);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .mountain-card:hover {
        transform: translateY(-15px) rotateX(5deg);
        box-shadow: 0 25px 50px rgba(30, 64, 175, 0.2);
    }
    
    .welsh-glow {
        box-shadow: 0 0 30px rgba(30, 64, 175, 0.4);
        animation: welshPulse 3s ease-in-out infinite alternate;
    }
    
    @keyframes welshPulse {
        from { box-shadow: 0 0 20px rgba(30, 64, 175, 0.4); }
        to { box-shadow: 0 0 40px rgba(5, 150, 105, 0.6); }
    }
    
    #mountain-3d-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }
    
    .heritage-overlay {
        position: relative;
        z-index: 2;
    }
    
    .magnetic-welsh {
        transition: transform 0.3s ease;
        cursor: pointer;
    }
    
    .mountain-scroll-indicator {
        animation: mountainBounce 2s infinite;
    }
    
    @keyframes mountainBounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-15px); }
        60% { transform: translateY(-8px); }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Welsh Mountain Background -->
<section class="relative min-h-screen overflow-hidden welsh-gradient">
    <!-- Three.js Mountain Scene -->
    <div id="mountain-3d-container"></div>
    
    <!-- Welsh Mountain Elements -->
    <div class="absolute inset-0 heritage-overlay">
        <!-- Floating mountain shapes -->
        <div class="absolute top-20 left-10 w-40 h-32 bg-blue-900 opacity-20 floating-mountain" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
        <div class="absolute top-32 right-20 w-32 h-24 bg-green-800 opacity-25 floating-mountain" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%); animation-delay: -3s;"></div>
        <div class="absolute bottom-40 left-1/4 w-24 h-18 bg-slate-700 opacity-30 floating-mountain" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%); animation-delay: -6s;"></div>
        
        <!-- Spring Water Ripples -->
        <div class="absolute top-1/2 left-1/2 w-6 h-6 spring-ripple rounded-full" style="animation-delay: 0s;"></div>
        <div class="absolute top-1/3 left-1/3 w-4 h-4 spring-ripple rounded-full" style="animation-delay: 2s;"></div>
        <div class="absolute top-2/3 right-1/3 w-5 h-5 spring-ripple rounded-full" style="animation-delay: 4s;"></div>
        
        <!-- Celtic Pattern Background -->
        <div class="absolute inset-0 celtic-pattern"></div>
    </div>
    
    <!-- Hero Content -->
    <div class="relative z-10 flex items-center justify-center min-h-screen">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="space-y-8">
                <!-- Main Headline -->
                <h1 class="text-6xl lg:text-8xl font-bold text-white leading-tight">
                    <span class="block welsh-text-shimmer" data-aos="fade-up" data-aos-delay="100">Pure</span>
                    <span class="block" data-aos="fade-up" data-aos-delay="200">Welsh</span>
                    <span class="block welsh-text-shimmer" data-aos="fade-up" data-aos-delay="300">Heritage</span>
                </h1>
                
                <!-- Subtitle -->
                <p class="text-xl lg:text-2xl text-blue-100 max-w-4xl mx-auto" data-aos="fade-up" data-aos-delay="400">
                    From the ancient valleys of Wales comes water so pure, it carries the essence of mountains 
                    that have stood for millennia. Experience the taste of pristine Welsh heritage.
                </p>
                
                <!-- Welsh Heritage Stats -->
                <div class="flex flex-col sm:flex-row gap-8 justify-center items-center mt-8" data-aos="fade-up" data-aos-delay="500">
                    <div class="text-center">
                        <div class="text-3xl font-bold welsh-text-shimmer">1000+</div>
                        <div class="text-blue-200">Years of Natural Filtration</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold welsh-text-shimmer">500m</div>
                        <div class="text-blue-200">Above Sea Level</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold welsh-text-shimmer">99.9%</div>
                        <div class="text-blue-200">Natural Purity</div>
                    </div>
                </div>
                
                <!-- Interactive CTAs -->
                <div class="flex flex-col sm:flex-row gap-6 justify-center items-center mt-12" data-aos="fade-up" data-aos-delay="600">
                    <button class="magnetic-welsh bg-white text-blue-900 px-8 py-4 rounded-full text-lg font-bold hover:bg-blue-50 transform hover:scale-105 transition-all duration-300 welsh-glow">
                        Discover Our Springs
                    </button>
                    <button class="magnetic-welsh mountain-mist text-white px-8 py-4 rounded-full text-lg font-bold hover:bg-white hover:bg-opacity-20 transition-all duration-300 border border-white border-opacity-30">
                        Visit Our Heritage
                    </button>
                </div>
                
                <!-- Scroll Indicator -->
                <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2">
                    <div class="mountain-scroll-indicator flex flex-col items-center">
                        <div class="w-1 h-8 bg-white rounded-full mb-2 water-drop"></div>
                        <div class="text-white text-sm">Explore the Valley</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Welsh Mountain Springs Showcase -->
<section class="py-20 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative overflow-hidden">
    <!-- Mountain Silhouette Background -->
    <div class="absolute bottom-0 left-0 right-0 h-64 bg-gradient-to-t from-slate-800 to-transparent" style="clip-path: polygon(0 100%, 10% 80%, 25% 85%, 40% 70%, 55% 75%, 70% 60%, 85% 65%, 100% 50%, 100% 100%);">
    </div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- Section Header -->
        <div class="text-center mb-16" data-aos="fade-up">
            <h2 class="text-5xl lg:text-6xl font-bold text-white mb-6">
                From Welsh <span class="welsh-text-shimmer">Mountains</span>
            </h2>
            <p class="text-xl text-blue-200 max-w-3xl mx-auto">
                Each bottle carries the story of ancient rocks, pristine valleys, and the purest mountain springs Wales has to offer.
            </p>
        </div>
        
        <!-- Welsh Mountain Product Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {% for product in featured_products %}
            <div class="mountain-card rounded-3xl p-8 text-center group relative overflow-hidden" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:100 }}">
                <!-- Welsh Pattern Overlay -->
                <div class="absolute inset-0 celtic-pattern rounded-3xl"></div>
                
                <!-- Product Bottle with Mountain Effect -->
                <div class="relative mb-6 z-10">
                    {% if product.images.first %}
                    <img src="{{ product.images.first.image.url }}" 
                         alt="{{ product.name }}" 
                         class="w-32 h-48 mx-auto object-contain group-hover:scale-110 transition-transform duration-500 filter drop-shadow-lg">
                    {% else %}
                    <div class="w-32 h-48 mx-auto bg-gradient-to-b from-blue-400 to-green-600 rounded-3xl welsh-glow group-hover:scale-110 transition-transform duration-500 flex items-center justify-center">
                        <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                        </svg>
                    </div>
                    {% endif %}
                    <div class="absolute inset-0 bg-white opacity-10 rounded-3xl transform rotate-12 group-hover:rotate-0 transition-transform duration-500"></div>
                </div>
                
                <h3 class="text-2xl font-bold text-white mb-4 group-hover:text-blue-300 transition-colors relative z-10">
                    {{ product.name }}
                </h3>
                <p class="text-blue-200 mb-6 relative z-10">{{ product.short_description|truncatechars:80 }}</p>
                
                <div class="flex items-center justify-between mb-6 relative z-10">
                    <span class="text-3xl font-bold text-white">£{{ product.price }}</span>
                    {% if product.average_rating > 0 %}
                    <div class="flex text-yellow-400">
                        {% for i in "12345" %}
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <button onclick="addToCart('{{ product.id }}')" class="w-full magnetic-welsh bg-gradient-to-r from-blue-600 to-green-600 text-white py-3 rounded-full font-bold hover:from-blue-700 hover:to-green-700 transform hover:scale-105 transition-all duration-300 relative z-10">
                    Add to Cart
                </button>
            </div>
            {% empty %}
            <!-- Demo Product Cards -->
            {% for i in "123" %}
            <div class="mountain-card rounded-3xl p-8 text-center group relative overflow-hidden" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:100 }}">
                <div class="absolute inset-0 celtic-pattern rounded-3xl"></div>
                
                <div class="relative mb-6 z-10">
                    <div class="w-32 h-48 mx-auto bg-gradient-to-b from-blue-400 to-green-600 rounded-3xl welsh-glow group-hover:scale-110 transition-transform duration-500 flex items-center justify-center">
                        <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                        </svg>
                    </div>
                </div>
                
                <h3 class="text-2xl font-bold text-white mb-4 group-hover:text-blue-300 transition-colors relative z-10">
                    Welsh Spring {{ i }}
                </h3>
                <p class="text-blue-200 mb-6 relative z-10">Pure mountain spring water from the heart of ancient Wales.</p>
                
                <div class="flex items-center justify-between mb-6 relative z-10">
                    <span class="text-3xl font-bold text-white">£{{ i }}.99</span>
                    <div class="flex text-yellow-400">
                        {% for j in "12345" %}
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        {% endfor %}
                    </div>
                </div>
                
                <button class="w-full magnetic-welsh bg-gradient-to-r from-blue-600 to-green-600 text-white py-3 rounded-full font-bold hover:from-blue-700 hover:to-green-700 transform hover:scale-105 transition-all duration-300 relative z-10">
                    Add to Cart
                </button>
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>
</section>

<!-- Welsh Heritage Story Section -->
<section class="py-20 bg-white relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
            <!-- Interactive Heritage Visualization -->
            <div class="relative" data-aos="fade-right">
                <div id="heritage-3d-container" class="h-96 bg-gradient-to-br from-blue-50 to-green-50 rounded-3xl relative overflow-hidden">
                    <!-- Mountain Layers Visualization -->
                    <div class="absolute inset-0 flex items-end justify-center p-8">
                        <div class="w-full max-w-md">
                            <!-- Mountain layers showing filtration -->
                            <div class="space-y-2">
                                <div class="h-8 bg-gradient-to-r from-slate-600 to-slate-700 rounded-t-full opacity-80"></div>
                                <div class="h-6 bg-gradient-to-r from-slate-500 to-slate-600 opacity-70"></div>
                                <div class="h-6 bg-gradient-to-r from-green-600 to-green-700 opacity-60"></div>
                                <div class="h-8 bg-gradient-to-r from-blue-400 to-blue-500 opacity-90 welsh-glow rounded-b-lg"></div>
                            </div>
                            <div class="text-center mt-4">
                                <div class="text-sm text-slate-600 font-medium">1000+ Years of Natural Filtration</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Heritage Story Content -->
            <div class="space-y-8" data-aos="fade-left">
                <h2 class="text-5xl lg:text-6xl font-bold text-gray-900">
                    Ancient <span class="welsh-text-shimmer">Welsh Purity</span>
                </h2>
                
                <div class="space-y-6">
                    <div class="flex items-start space-x-4 p-6 rounded-2xl hover:bg-blue-50 transition-colors duration-300 mountain-card">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-green-600 rounded-full flex items-center justify-center welsh-glow">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Mountain Filtration</h3>
                            <p class="text-gray-600">Naturally filtered through layers of ancient Welsh rock formations over centuries.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-6 rounded-2xl hover:bg-green-50 transition-colors duration-300 mountain-card">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-600 to-blue-600 rounded-full flex items-center justify-center welsh-glow">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Welsh Heritage</h3>
                            <p class="text-gray-600">Protected by sustainable practices that honor our Welsh landscape for future generations.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-6 rounded-2xl hover:bg-slate-50 transition-colors duration-300 mountain-card">
                        <div class="w-12 h-12 bg-gradient-to-br from-slate-600 to-green-600 rounded-full flex items-center justify-center welsh-glow">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Mineral Perfection</h3>
                            <p class="text-gray-600">Natural mineral balance achieved through millennia of geological processes in Welsh valleys.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Welsh Valley Newsletter Section -->
<section class="py-20 bg-gradient-to-r from-blue-900 via-slate-900 to-green-900 relative overflow-hidden">
    <!-- Welsh Mountain Silhouettes -->
    <div class="absolute inset-0 opacity-20">
        <div class="absolute bottom-0 left-0 right-0 h-48" style="background: linear-gradient(to right, transparent, rgba(30,64,175,0.3), transparent); clip-path: polygon(0 100%, 15% 70%, 30% 80%, 45% 60%, 60% 75%, 75% 55%, 90% 70%, 100% 50%, 100% 100%);"></div>
        <div class="absolute bottom-0 left-0 right-0 h-32" style="background: linear-gradient(to right, transparent, rgba(5,150,105,0.3), transparent); clip-path: polygon(0 100%, 20% 80%, 40% 85%, 60% 70%, 80% 75%, 100% 65%, 100% 100%);"></div>
    </div>
    
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
        <div class="mountain-mist rounded-3xl p-12" data-aos="zoom-in">
            <h2 class="text-4xl lg:text-5xl font-bold text-white mb-6">
                Join the Welsh <span class="welsh-text-shimmer">Valley</span>
            </h2>
            <p class="text-xl text-blue-200 mb-8">
                Be the first to taste new springs, learn about our heritage, and receive exclusive access to limited valley collections.
            </p>
            
            <form class="flex flex-col sm:flex-row gap-4 max-w-lg mx-auto" id="heritage-newsletter-form">
                {% csrf_token %}
                <input type="email" name="email" placeholder="Enter your email for valley updates..." required
                       class="flex-1 px-6 py-4 rounded-full bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 backdrop-blur-sm">
                <button type="submit" class="magnetic-welsh bg-gradient-to-r from-blue-600 to-green-600 text-white px-8 py-4 rounded-full font-bold hover:from-blue-700 hover:to-green-700 transform hover:scale-105 transition-all duration-300 welsh-glow">
                    Join Valley
                </button>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- GSAP, Three.js, and AOS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<script>
// Initialize AOS
AOS.init({
    duration: 1000,
    easing: 'ease-out-cubic',
    once: true
});

// Three.js Mountain Scene
let mountainScene, mountainCamera, mountainRenderer, mountainParticles;

function initMountainScene() {
    const container = document.getElementById('mountain-3d-container');
    if (!container) return;
    
    mountainScene = new THREE.Scene();
    mountainCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    mountainRenderer = new THREE.WebGLRenderer({ alpha: true });
    mountainRenderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(mountainRenderer.domElement);
    
    // Create mountain-like particles
    const geometry = new THREE.BufferGeometry();
    const vertices = [];
    const colors = [];
    
    for (let i = 0; i < 1500; i++) {
        vertices.push(
            Math.random() * 2000 - 1000,
            Math.random() * 1000 - 500,
            Math.random() * 2000 - 1000
        );
        
        // Welsh-inspired colors (blues and greens)
        colors.push(
            Math.random() * 0.3 + 0.2, // Blue tones
            Math.random() * 0.4 + 0.4, // Green tones  
            Math.random() * 0.3 + 0.7  // Brightness
        );
    }
    
    geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
    
    const material = new THREE.PointsMaterial({
        size: 2,
        vertexColors: true,
        transparent: true,
        opacity: 0.6
    });
    
    mountainParticles = new THREE.Points(geometry, material);
    mountainScene.add(mountainParticles);
    
    mountainCamera.position.z = 1000;
    
    animateMountainScene();
}

function animateMountainScene() {
    requestAnimationFrame(animateMountainScene);
    
    if (mountainParticles) {
        mountainParticles.rotation.x += 0.0002;
        mountainParticles.rotation.y += 0.0005;
    }
    
    mountainRenderer.render(mountainScene, mountainCamera);
}

// Welsh Magnetic Button Effects
document.querySelectorAll('.magnetic-welsh').forEach(button => {
    button.addEventListener('mousemove', function(e) {
        const rect = button.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        
        gsap.to(button, {
            x: x * 0.1,
            y: y * 0.1,
            duration: 0.3,
            ease: "power2.out"
        });
    });
    
    button.addEventListener('mouseleave', function() {
        gsap.to(button, {
            x: 0,
            y: 0,
            duration: 0.5,
            ease: "elastic.out(1, 0.3)"
        });
    });
});

// Welsh Mountain Parallax
window.addEventListener('scroll', function() {
    const scrolled = window.pageYOffset;
    const mountainElements = document.querySelectorAll('.floating-mountain');
    
    mountainElements.forEach((element, index) => {
        const speed = (index + 1) * 0.3;
        gsap.to(element, {
            y: -scrolled * speed,
            rotation: scrolled * 0.05,
            duration: 0.1
        });
    });
});

// Welsh Heritage Newsletter
document.getElementById('heritage-newsletter-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const button = this.querySelector('button');
    const originalText = button.textContent;
    
    // Welsh mountain animation
    gsap.to(button, {
        scale: 0.95,
        duration: 0.1,
        yoyo: true,
        repeat: 1
    });
    
    button.textContent = 'Connecting to Valley...';
    
    // Simulate connection to Welsh heritage
    setTimeout(() => {
        button.textContent = 'Welcome to the Valley!';
        gsap.fromTo(button, 
            { backgroundColor: '#059669' },
            { backgroundColor: '#1e40af', duration: 2 }
        );
        
        // Create Welsh mountain particles
        createWelshParticles(button);
        
        setTimeout(() => {
            button.textContent = originalText;
        }, 2000);
    }, 1500);
});

// Create Welsh Mountain Particles
function createWelshParticles(element) {
    const rect = element.getBoundingClientRect();
    
    for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.className = 'fixed w-3 h-3 pointer-events-none z-50';
        particle.style.left = rect.left + rect.width / 2 + 'px';
        particle.style.top = rect.top + rect.height / 2 + 'px';
        
        // Welsh colors
        const colors = ['#1e40af', '#059669', '#0284c7', '#065f46'];
        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        particle.style.borderRadius = '50%';
        
        document.body.appendChild(particle);
        
        gsap.to(particle, {
            x: (Math.random() - 0.5) * 150,
            y: (Math.random() - 0.5) * 150,
            opacity: 0,
            scale: 0,
            duration: 1.2,
            ease: "power2.out",
            onComplete: () => particle.remove()
        });
    }
}

// Welsh Mountain Card Interactions
document.querySelectorAll('.mountain-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        gsap.to(this, {
            rotationY: 8,
            rotationX: 4,
            duration: 0.3,
            ease: "power2.out"
        });
    });
    
    card.addEventListener('mouseleave', function() {
        gsap.to(this, {
            rotationY: 0,
            rotationX: 0,
            duration: 0.5,
            ease: "elastic.out(1, 0.3)"
        });
    });
});

// Welsh Text Animations
gsap.from(".welsh-text-shimmer", {
    y: 80,
    opacity: 0,
    duration: 1.2,
    stagger: 0.2,
    ease: "back.out(1.7)"
});

// Initialize Mountain Scene
window.addEventListener('load', function() {
    setTimeout(initMountainScene, 100);
});

// Handle resize for mountain scene
window.addEventListener('resize', function() {
    if (mountainCamera && mountainRenderer) {
        mountainCamera.aspect = window.innerWidth / window.innerHeight;
        mountainCamera.updateProjectionMatrix();
        mountainRenderer.setSize(window.innerWidth, window.innerHeight);
    }
});

// Welsh Valley Scroll Animations
gsap.registerPlugin(ScrollTrigger);

gsap.from(".mountain-card", {
    scrollTrigger: {
        trigger: ".mountain-card",
        start: "top 80%",
        stagger: 0.2
    },
    y: 50,
    opacity: 0,
    duration: 0.8,
    ease: "power2.out"
});

// Welsh Spring Water Drop Animation
function createWaterDrop(x, y) {
    const drop = document.createElement('div');
    drop.className = 'fixed w-2 h-3 bg-blue-400 rounded-full pointer-events-none z-20 opacity-70';
    drop.style.left = x + 'px';
    drop.style.top = y + 'px';
    drop.style.borderRadius = '50% 50% 50% 50% / 60% 60% 40% 40%';
    
    document.body.appendChild(drop);
    
    gsap.to(drop, {
        y: "+=100",
        opacity: 0,
        duration: 2,
        ease: "power2.in",
        onComplete: () => drop.remove()
    });
}

// Random water drops (subtle effect)
if (window.innerWidth > 768) {
    setInterval(() => {
        if (Math.random() > 0.95) {
            createWaterDrop(
                Math.random() * window.innerWidth,
                -10
            );
        }
    }, 2000);
}

// Welsh Heritage Loading Effect
window.addEventListener('beforeunload', function() {
    document.body.style.opacity = '0.9';
    document.body.style.filter = 'blur(1px)';
});
</script>
{% endblock %}