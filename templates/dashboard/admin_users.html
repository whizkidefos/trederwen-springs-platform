{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block title %}Admin Users | Dashboard{% endblock %}

{% block content %}
<div class="container px-6 mx-auto grid">
    <h2 class="my-6 text-2xl font-semibold text-gray-700">
        Admin Users Management
    </h2>
    
    <!-- Admin Users Stats Cards -->
    <div class="grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4">
        <!-- Total Admin Users -->
        <div class="flex items-center p-4 bg-white rounded-lg shadow-md">
            <div class="p-3 mr-4 text-blue-500 bg-blue-100 rounded-full">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path>
                </svg>
            </div>
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">
                    Total Admin Users
                </p>
                <p class="text-lg font-semibold text-gray-700">
                    {{ admin_stats.total }}
                </p>
            </div>
        </div>
        
        <!-- Active Admin Users -->
        <div class="flex items-center p-4 bg-white rounded-lg shadow-md">
            <div class="p-3 mr-4 text-green-500 bg-green-100 rounded-full">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">
                    Active Admins
                </p>
                <p class="text-lg font-semibold text-gray-700">
                    {{ admin_stats.active }}
                </p>
            </div>
        </div>
        
        <!-- Inactive Admin Users -->
        <div class="flex items-center p-4 bg-white rounded-lg shadow-md">
            <div class="p-3 mr-4 text-red-500 bg-red-100 rounded-full">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">
                    Inactive Admins
                </p>
                <p class="text-lg font-semibold text-gray-700">
                    {{ admin_stats.inactive }}
                </p>
            </div>
        </div>
        
        <!-- Superusers -->
        <div class="flex items-center p-4 bg-white rounded-lg shadow-md">
            <div class="p-3 mr-4 text-purple-500 bg-purple-100 rounded-full">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div>
                <p class="mb-2 text-sm font-medium text-gray-600">
                    Superusers
                </p>
                <p class="text-lg font-semibold text-gray-700">
                    {{ admin_stats.superusers }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Admin Users List and Form -->
    <div class="grid gap-6 mb-8 md:grid-cols-2">
        <!-- Admin Users List -->
        <div class="p-4 bg-white rounded-lg shadow-md">
            <h3 class="mb-4 text-xl font-semibold text-gray-700">Admin Users</h3>
            
            <div class="w-full overflow-hidden rounded-lg shadow-xs">
                <div class="w-full overflow-x-auto">
                    <table class="w-full whitespace-no-wrap">
                        <thead>
                            <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b bg-gray-50">
                                <th class="px-4 py-3">User</th>
                                <th class="px-4 py-3">Title</th>
                                <th class="px-4 py-3">Status</th>
                                <th class="px-4 py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y">
                            {% for user in admin_users %}
                            <tr class="text-gray-700">
                                <td class="px-4 py-3">
                                    <div class="flex items-center text-sm">
                                        <div class="relative hidden w-8 h-8 mr-3 rounded-full md:block">
                                            {% if user.avatar %}
                                            <img class="object-cover w-full h-full rounded-full" src="{{ user.avatar.url }}" alt="{{ user.get_full_name }}" loading="lazy">
                                            {% else %}
                                            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                                                {{ user.first_name.0|default:"A" }}
                                            </div>
                                            {% endif %}
                                            <div class="absolute inset-0 rounded-full shadow-inner" aria-hidden="true"></div>
                                        </div>
                                        <div>
                                            <p class="font-semibold">{{ user.get_full_name }}</p>
                                            <p class="text-xs text-gray-600">{{ user.email }}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-sm">
                                    {{ user.admin_title|default:"--" }}
                                </td>
                                <td class="px-4 py-3 text-xs">
                                    {% if user.is_active %}
                                    <span class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full">
                                        Active
                                    </span>
                                    {% else %}
                                    <span class="px-2 py-1 font-semibold leading-tight text-red-700 bg-red-100 rounded-full">
                                        Inactive
                                    </span>
                                    {% endif %}
                                    
                                    {% if user.is_superuser %}
                                    <span class="px-2 py-1 font-semibold leading-tight text-purple-700 bg-purple-100 rounded-full ml-1">
                                        Superuser
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3 text-sm">
                                    <a href="{% url 'dashboard:edit_admin_user' user.id %}" class="text-blue-600 hover:text-blue-900">Edit</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="px-4 py-3 text-sm text-center text-gray-500">
                                    No admin users found.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Add Admin User Form -->
        <div class="p-4 bg-white rounded-lg shadow-md">
            <h3 class="mb-4 text-xl font-semibold text-gray-700">Add New Admin User</h3>
            
            <form method="post" action="{% url 'dashboard:admin_users' %}">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="mb-4 p-3 bg-red-100 text-red-800 rounded-lg">
                    {% for error in form.non_field_errors %}
                    <p>{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- Email -->
                    <div class="col-span-2">
                        <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Email Address*</label>
                        {{ form.email }}
                        {% if form.email.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- First Name -->
                    <div>
                        <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">First Name*</label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Last Name -->
                    <div>
                        <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Last Name*</label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Admin Title -->
                    <div>
                        <label for="{{ form.admin_title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Admin Title</label>
                        {{ form.admin_title }}
                        {% if form.admin_title.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.admin_title.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Admin Department -->
                    <div>
                        <label for="{{ form.admin_department.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                        {{ form.admin_department }}
                        {% if form.admin_department.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.admin_department.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Admin Bio -->
                    <div class="col-span-2">
                        <label for="{{ form.admin_bio.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
                        {{ form.admin_bio }}
                        {% if form.admin_bio.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.admin_bio.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Password -->
                    <div>
                        <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Password*</label>
                        <div class="relative">
                            {{ form.password1 }}
                            <button type="button" class="toggle-password absolute inset-y-0 right-0 pr-3 flex items-center text-gray-600 focus:outline-none">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% if form.password1.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.password1.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Confirm Password -->
                    <div>
                        <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password*</label>
                        <div class="relative">
                            {{ form.password2 }}
                            <button type="button" class="toggle-password-confirm absolute inset-y-0 right-0 pr-3 flex items-center text-gray-600 focus:outline-none">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% if form.password2.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.password2.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Permissions -->
                    <div class="col-span-2">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Permissions</h4>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                {{ form.is_superuser }}
                                <label for="{{ form.is_superuser.id_for_label }}" class="ml-2 block text-sm text-gray-700">
                                    Superuser status (full access to all features)
                                </label>
                            </div>
                            <div class="flex items-center">
                                {{ form.is_staff }}
                                <label for="{{ form.is_staff.id_for_label }}" class="ml-2 block text-sm text-gray-700">
                                    Staff status (can access Django admin)
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-blue-600 border border-transparent rounded-lg active:bg-blue-600 hover:bg-blue-700 focus:outline-none focus:shadow-outline-blue">
                        Create Admin User
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Password visibility toggle for first password field
        const togglePassword = document.querySelector('.toggle-password');
        const passwordInput = document.querySelector('#id_password1');
        
        if (togglePassword && passwordInput) {
            togglePassword.addEventListener('click', function() {
                // Toggle password visibility
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Toggle eye icon
                const eyeIcon = this.querySelector('i');
                eyeIcon.classList.toggle('fa-eye');
                eyeIcon.classList.toggle('fa-eye-slash');
            });
        }
        
        // Password visibility toggle for confirm password field
        const togglePasswordConfirm = document.querySelector('.toggle-password-confirm');
        const passwordConfirmInput = document.querySelector('#id_password2');
        
        if (togglePasswordConfirm && passwordConfirmInput) {
            togglePasswordConfirm.addEventListener('click', function() {
                // Toggle password visibility
                const type = passwordConfirmInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordConfirmInput.setAttribute('type', type);
                
                // Toggle eye icon
                const eyeIcon = this.querySelector('i');
                eyeIcon.classList.toggle('fa-eye');
                eyeIcon.classList.toggle('fa-eye-slash');
            });
        }
    });
</script>
{% endblock %}
